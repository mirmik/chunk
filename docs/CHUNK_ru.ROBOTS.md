# CHUNK_ru.ROBOTS.md

Этот документ предназначен для **языковых моделей**.
Твоя задача — **генерировать CHUNK-патчи строго в описанном формате**, без фантазий и самодеятельности.

---

## 1. Жёсткие правила формата (обязательно прочитай)

1. **Только один YAML-документ.**
   В ответе не должно быть ничего, кроме одного YAML-блока CHUNK. Никакого текста до или после.

2. **Формат — упрощённый YAML.**

   * Используй **пробелы** для отступов (не табы).
   * Рекомендуемый отступ — **2 пробела**.
   * Ключи и значения — обычный YAML 1.2.

3. **Без комментариев.**
   Не используй строки, начинающиеся с `#`.
   Комментарии внутри документа недопустимы.

4. **Только описанные поля.**

   * Нельзя придумывать свои поля.
   * Нельзя менять имена полей.
   * Нельзя добавлять лишние поля «для красоты».

5. **Только известные команды.**
   Значение поля `op` **обязательно** должно быть одной из известных команд (см. раздел 2).
   Никаких новых или «похожих» названий.

6. **Многострочные строки (`text`, большие фрагменты кода).**

   * Для многострочного текста **всегда** используй YAML-литерал `|`.
   * Содержимое блока `|` должно быть с отступом минимум 2 пробела относительно ключа.
   * Пример:

     ```yaml
     text: |
       первая строка
       вторая строка
     ```

7. **Кодировка.**
   Считается, что всё в UTF-8. Символы юникода допустимы.

8. **Относительные пути файлов.**

   * Поле `path` всегда задаёт **относительный путь от корня репозитория**.
   * Директория `.scatwrap/` не является частью пути.
   * Примеры:

     * правильно: `src/main.cpp`
     * неправильно: `.scatwrap/src/main.cpp`

9. **Структура верхнего уровня всегда одна и та же:**

   ```yaml
   description: "краткое описание патча на человеческом языке"
   language: "ru"
   operations:
     - op: ...
       ...
     - op: ...
       ...
   ```

---

## 2. Полный список команд

Команды бывают трёх типов: операции с файлами, текстовые операции и языковые (структурные) операции для кода.

### 2.1. Операции с файлами

* `create-file` — создать новый файл с указанным содержимым.
* `delete-file` — удалить существующий файл.

### 2.2. Текстовые операции

Работают с текстом файла как с последовательностью строк.

* `append-text` — дописать текст **в конец файла**.
* `prepend-text` — дописать текст **в начало файла**.
* `insert-before-text` — вставить текст **перед найденным маркером**.
* `insert-after-text` — вставить текст **после найденного маркера**.
* `replace-text` — найти маркер и **заменить его на указанный текст**.
* `delete-text` — найти маркер и **удалить его**.

### 2.3. Языковые операции (структурное API для кода)

Используются для работы с сущностями языков C++ и Python.
Применяй их **вместо `replace-text`**, когда нужно менять классы или методы.

* `replace-cpp-class` — заменить определение класса в C++-файле.
* `replace-cpp-method` — заменить определение метода (функции-члена) в C++-классе.
* `replace-py-class` — заменить определение класса в Python-файле.
* `replace-py-method` — заменить определение метода в Python-классе.

**Важно:**
Не придумывай новых команд. Используй только перечисленные выше значения `op`.

---

## 3. Структура документа CHUNK

### 3.1. Поля верхнего уровня

```yaml
description: "Краткое описание, что делает патч"
language: "ru"
operations:
  - op: ...
    ...
  - op: ...
    ...
```

* `description` — произвольное краткое описание патча на естественном языке.
* `language` — язык описания/комментариев (`"ru"` или `"en"` и так далее).
* `operations` — список операций. Каждая операция — отдельный YAML-объект (элемент списка).

### 3.2. Общие правила для операций

Каждая операция в `operations` имеет вид:

```yaml
- op: <имя-команды>
  path: <путь/к/файлу>
  ...другие поля команды...
```

Общие поля:

* `op` — имя команды из списка в разделе 2.
* `path` — путь к файлу относительно корня репозитория.

**Нельзя**:

* пропускать обязательные для команды поля;
* добавлять произвольные поля, не описанные для соответствующей команды.

---

## 4. Подробности по командам и примеры

Ниже — формат аргументов для каждой команды и пример минимально корректного использования.

### 4.1. Операции с файлами

#### 4.1.1. `create-file`

Создать новый файл с указанным содержимым.
Если файл уже существует — поведение определяется реализацией (обычно ошибка).

**Поля:**

* `op: "create-file"`
* `path` — путь к создаваемому файлу.
* `text` — полный текст файла.

**Пример:**

```yaml
- op: create-file
  path: src/new_module.cpp
  text: |
    #include "new_module.h"

    int add(int a, int b) {
        return a + b;
    }
```

---

#### 4.1.2. `delete-file`

Удалить существующий файл.

**Поля:**

* `op: "delete-file"`
* `path` — путь к файлу, который нужно удалить.

**Пример:**

```yaml
- op: delete-file
  path: src/obsolete.cpp
```

---

### 4.2. Текстовые операции

Во всех текстовых командах используется строка-маркер, по которой находится место изменения.
Модель должна подбирать маркер так, чтобы он **однозначно соответствовал нужному фрагменту**.

#### 4.2.1. `append-text`

Добавить текст в конец файла.

**Поля:**

* `op: "append-text"`
* `path` — путь к файлу.
* `text` — текст, который нужно дописать в конец (с переводами строк, если нужно).

**Пример:**

```yaml
- op: append-text
  path: README.md
  text: |
    ## License

    MIT
```

---

#### 4.2.2. `prepend-text`

Добавить текст в начало файла.

**Поля:**

* `op: "prepend-text"`
* `path`
* `text`

**Пример:**

```yaml
- op: prepend-text
  path: src/main.cpp
  text: |
    // This file is generated by CHUNK
```

---

#### 4.2.3. `insert-before-text`

Вставить текст **перед** найденным маркером.

**Поля:**

* `op: "insert-before-text"`
* `path`
* `marker` — фрагмент текста, который нужно найти в файле.
* `text` — текст, который нужно вставить **перед** маркером.

**Пример:**

```yaml
- op: insert-before-text
  path: src/main.cpp
  marker: "int main(int argc, char** argv)"
  text: |
    // Application entry point
```

---

#### 4.2.4. `insert-after-text`

Вставить текст **после** найденного маркера.

**Поля:**

* `op: "insert-after-text"`
* `path`
* `marker`
* `text`

**Пример:**

```yaml
- op: insert-after-text
  path: src/logger.cpp
  marker: "Logger::Logger() {"
  text: |
        init_default_sink();
```

---

#### 4.2.5. `replace-text`

Найти маркер и заменить его указанным текстом.

**Поля:**

* `op: "replace-text"`
* `path`
* `marker` — заменяемый фрагмент текста.
* `text` — новый текст, вставляемый вместо маркера.

**Пример:**

```yaml
- op: replace-text
  path: src/config.h
  marker: "#define VERSION \"0.1.0\""
  text: |
    #define VERSION "0.2.0"
```

---

#### 4.2.6. `delete-text`

Удалить найденный маркер.

**Поля:**

* `op: "delete-text"`
* `path`
* `marker` — текст, который нужно удалить.

**Пример:**

```yaml
- op: delete-text
  path: src/debug.cpp
  marker: "std::cout << \"DEBUG\" << std::endl;"
```

---

### 4.3. Языковые операции для C++ и Python

Эти команды работают не по «сырому тексту», а по структуре кода (классы, методы).
Используй их для безопасной замены классов/методов вместо `replace-text`.

> ⚠ Конкретный синтаксис поиска (учёт пробелов, комментариев и так далее) реализован на стороне утилиты.
> Твоя задача — корректно заполнить поля: оп, путь, имя класса/метода и новый код.

#### 4.3.1. `replace-cpp-class`

Заменить определение C++-класса целиком.

**Поля (минимально):**

* `op: "replace-cpp-class"`
* `path` — путь к C++-файлу (`.h`, `.hpp`, `.cpp` и так далее).
* `class` — имя класса, который нужно заменить.
* `text` — новое определение класса (полный код класса).

**Пример:**

```yaml
- op: replace-cpp-class
  path: src/foo.h
  class: Foo
  text: |
    class Foo {
    public:
        explicit Foo(int value);
        int value() const;
    private:
        int value_;
    };
```

---

#### 4.3.2. `replace-cpp-method`

Заменить определение метода C++ внутри класса.

**Поля (минимально):**

* `op: "replace-cpp-method"`
* `path` — путь к файлу, содержащему реализацию метода.
* `class` — имя класса.
* `method` — имя метода.
* `text` — новое полное определение метода (с сигнатурой и телом).

**Пример:**

```yaml
- op: replace-cpp-method
  path: src/foo.cpp
  class: Foo
  method: value
  text: |
    int Foo::value() const {
        return value_ * 2;
    }
```

---

#### 4.3.3. `replace-py-class`

Заменить определение Python-класса.

**Поля:**

* `op: "replace-py-class"`
* `path` — путь к `.py`-файлу.
* `class` — имя класса.
* `text` — новое полное определение класса.

**Пример:**

```yaml
- op: replace-py-class
  path: app/models.py
  class: User
  text: |
    class User:
        def __init__(self, name: str) -> None:
            self.name = name
```

---

#### 4.3.4. `replace-py-method`

Заменить метод внутри Python-класса.

**Поля:**

* `op: "replace-py-method"`
* `path`
* `class` — имя класса.
* `method` — имя метода.
* `text` — новое определение метода (с `def` и телом).

**Пример:**

```yaml
- op: replace-py-method
  path: app/models.py
  class: User
  method: greet
  text: |
    def greet(self) -> str:
        return f"Hello, {self.name}!"
```

---

## 5. Чего делать нельзя

1. Нельзя добавлять текст до или после YAML-документа CHUNK.
2. Нельзя придумывать свои команды (`op`) или поля.
3. Нельзя менять структуру верхнего уровня (`description`, `language`, `operations`).
4. Нельзя забывать обязательные поля для выбранной команды.
5. Нельзя использовать комментарии `#` внутри YAML.

---

## 6. Рекомендуемая базовая форма ответа

Когда от тебя требуется сгенерировать патч CHUNK, отвечай **ровно в таком виде** (пример skeleton):

```yaml
description: "Кратко, что делает патч"
language: "ru"
operations:
  - op: ...
    path: ...
    ...
  - op: ...
    path: ...
    ...
```
