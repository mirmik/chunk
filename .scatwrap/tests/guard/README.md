<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>tests/guard/README.md</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
````markdown<br>
Headers-only&nbsp;кроссплатформенная&nbsp;тестовая&nbsp;система&nbsp;подделывающаяся&nbsp;под&nbsp;облегчённый&nbsp;doctest.<br>
Стандарт&nbsp;C++11&nbsp;и&nbsp;выше.<br>
<br>
##&nbsp;Минимальный&nbsp;пример<br>
<br>
```cpp<br>
#include&nbsp;&quot;guard.h&quot;<br>
#include&nbsp;&lt;stdexcept&gt;<br>
<br>
TEST_CASE(&quot;simple&nbsp;arithmetic&quot;)<br>
{<br>
&nbsp;&nbsp;&nbsp;&nbsp;CHECK_EQ(2&nbsp;+&nbsp;2,&nbsp;4);<br>
&nbsp;&nbsp;&nbsp;&nbsp;CHECK_LT(1,&nbsp;10);<br>
}<br>
<br>
GUARD_TEST_MAIN();<br>
````<br>
<br>
Примеры&nbsp;использования&nbsp;смотрите&nbsp;в&nbsp;документации&nbsp;doctest&nbsp;—&nbsp;синтаксис&nbsp;и&nbsp;семантика&nbsp;максимально&nbsp;похожи.<br>
<br>
---<br>
<br>
##&nbsp;API&nbsp;(application&nbsp;programming&nbsp;interface,&nbsp;программный&nbsp;интерфейс)<br>
<br>
###&nbsp;Объявление&nbsp;тестов&nbsp;и&nbsp;запуск<br>
<br>
*&nbsp;`TEST_CASE(&quot;name&quot;)`<br>
&nbsp;&nbsp;Объявляет&nbsp;и&nbsp;регистрирует&nbsp;тест&nbsp;с&nbsp;указанным&nbsp;именем.<br>
<br>
*&nbsp;`GUARD_TEST_MAIN()`<br>
&nbsp;&nbsp;Генерирует&nbsp;`main`&nbsp;и&nbsp;запускает&nbsp;все&nbsp;зарегистрированные&nbsp;тесты.<br>
&nbsp;&nbsp;Поддерживает&nbsp;фильтр&nbsp;по&nbsp;подстроке&nbsp;имени&nbsp;теста:<br>
<br>
&nbsp;&nbsp;*&nbsp;`--test-case=Substring`<br>
&nbsp;&nbsp;*&nbsp;`--test-case&nbsp;Substring`<br>
<br>
*&nbsp;`guard::test::run_all(const&nbsp;char*&nbsp;test_filter&nbsp;=&nbsp;nullptr,&nbsp;std::ostream&amp;&nbsp;os&nbsp;=&nbsp;std::cout)`<br>
&nbsp;&nbsp;Низкоуровневый&nbsp;запускатель&nbsp;тестов&nbsp;(можно&nbsp;использовать&nbsp;вместо&nbsp;`GUARD_TEST_MAIN`).<br>
<br>
---<br>
<br>
###&nbsp;Макросы&nbsp;проверок&nbsp;(алиасы,&nbsp;включены&nbsp;по&nbsp;умолчанию)<br>
<br>
Мягкие&nbsp;(soft,&nbsp;не&nbsp;рвут&nbsp;тест,&nbsp;только&nbsp;копят&nbsp;ошибки):<br>
<br>
*&nbsp;`CHECK(expr)`<br>
*&nbsp;`CHECK_FALSE(expr)`<br>
*&nbsp;`CHECK_EQ(a,&nbsp;b)`&nbsp;&nbsp;&nbsp;&nbsp;—&nbsp;ожидание&nbsp;`a&nbsp;==&nbsp;b`<br>
*&nbsp;`CHECK_NEQ(a,&nbsp;b)`&nbsp;&nbsp;&nbsp;—&nbsp;ожидание&nbsp;`a&nbsp;!=&nbsp;b`<br>
*&nbsp;`CHECK_LT(a,&nbsp;b)`&nbsp;&nbsp;&nbsp;&nbsp;—&nbsp;ожидание&nbsp;`a&nbsp;&lt;&nbsp;&nbsp;b`<br>
*&nbsp;`CHECK_GT(a,&nbsp;b)`&nbsp;&nbsp;&nbsp;&nbsp;—&nbsp;ожидание&nbsp;`a&nbsp;&gt;&nbsp;&nbsp;b`<br>
<br>
Жёсткие&nbsp;(hard,&nbsp;немедленно&nbsp;останавливают&nbsp;текущий&nbsp;тест):<br>
<br>
*&nbsp;`REQUIRE(expr)`<br>
*&nbsp;`REQUIRE_FALSE(expr)`<br>
*&nbsp;`REQUIRE_EQ(a,&nbsp;b)`<br>
*&nbsp;`REQUIRE_NEQ(a,&nbsp;b)`<br>
*&nbsp;`REQUIRE_LT(a,&nbsp;b)`<br>
*&nbsp;`REQUIRE_GT(a,&nbsp;b)`<br>
<br>
Для&nbsp;сравнительных&nbsp;макросов&nbsp;в&nbsp;сообщении&nbsp;об&nbsp;ошибке&nbsp;указывается:<br>
<br>
*&nbsp;файл,&nbsp;строка,&nbsp;функция;<br>
*&nbsp;исходное&nbsp;выражение;<br>
*&nbsp;значения&nbsp;левой&nbsp;и&nbsp;правой&nbsp;части&nbsp;(через&nbsp;`operator&lt;&lt;`).<br>
<br>
---<br>
<br>
###&nbsp;Исключения<br>
<br>
(все&nbsp;фатальные:&nbsp;при&nbsp;нарушении&nbsp;ожиданий&nbsp;текущий&nbsp;тест&nbsp;сразу&nbsp;завершается)<br>
<br>
*&nbsp;`CHECK_THROWS(code)`<br>
&nbsp;&nbsp;Ожидается&nbsp;любое&nbsp;исключение.<br>
<br>
*&nbsp;`CHECK_THROWS_AS(code,&nbsp;ExType)`<br>
&nbsp;&nbsp;Ожидается&nbsp;исключение&nbsp;типа&nbsp;`ExType`.<br>
<br>
*&nbsp;`CHECK_NOTHROW(code)`<br>
&nbsp;&nbsp;Ожидается&nbsp;отсутствие&nbsp;исключений.<br>
<br>
---<br>
<br>
###&nbsp;Таймаут<br>
<br>
*&nbsp;`CHECK_TIMEOUT(code,&nbsp;ms)`<br>
&nbsp;&nbsp;Выполняет&nbsp;`code`,&nbsp;измеряет&nbsp;длительность,&nbsp;сравнивает&nbsp;с&nbsp;лимитом&nbsp;`ms`&nbsp;(миллисекунды).<br>
&nbsp;&nbsp;При&nbsp;превышении&nbsp;лимита&nbsp;—&nbsp;фатальный&nbsp;провал&nbsp;с&nbsp;отчётом&nbsp;о&nbsp;фактическом&nbsp;времени.<br>
<br>
---<br>
<br>
###&nbsp;Явный&nbsp;провал<br>
<br>
*&nbsp;`FAIL(message)`<br>
&nbsp;&nbsp;Принудительно&nbsp;помечает&nbsp;тест&nbsp;как&nbsp;проваленный&nbsp;с&nbsp;указанным&nbsp;сообщением&nbsp;и&nbsp;немедленно&nbsp;его&nbsp;завершает.<br>
<br>
---<br>
<br>
###&nbsp;Приближённые&nbsp;сравнения<br>
<br>
Класс&nbsp;`guard::Approx`&nbsp;(из&nbsp;`util.h`)&nbsp;для&nbsp;сравнения&nbsp;чисел&nbsp;с&nbsp;допуском:<br>
<br>
*&nbsp;`Approx(double&nbsp;value)`&nbsp;—&nbsp;целевое&nbsp;значение.<br>
*&nbsp;`Approx&amp;&nbsp;epsilon(double&nbsp;eps)`&nbsp;—&nbsp;относительная&nbsp;погрешность.<br>
*&nbsp;`Approx&amp;&nbsp;scale(double&nbsp;s)`&nbsp;—&nbsp;масштаб&nbsp;(аналогично&nbsp;doctest/Catch2).<br>
*&nbsp;`Approx&nbsp;operator()(double&nbsp;value)&nbsp;const`&nbsp;—&nbsp;создание&nbsp;копии&nbsp;с&nbsp;новым&nbsp;значением.<br>
<br>
Поддерживаются&nbsp;сравнения:<br>
<br>
*&nbsp;`x&nbsp;==&nbsp;Approx(...)`<br>
*&nbsp;`Approx(...)&nbsp;==&nbsp;x`<br>
*&nbsp;`x&nbsp;!=&nbsp;Approx(...)`<br>
*&nbsp;`Approx(...)&nbsp;!=&nbsp;x`<br>
<br>
Логика&nbsp;сравнения:&nbsp;число&nbsp;считается&nbsp;равным,&nbsp;если&nbsp;модуль&nbsp;разницы&nbsp;не&nbsp;превосходит&nbsp;рассчитанного&nbsp;допуска.<br>
<br>
---<br>
<br>
###&nbsp;Конфигурация&nbsp;алиасов<br>
<br>
По&nbsp;умолчанию&nbsp;подключение&nbsp;`guard.h`&nbsp;объявляет&nbsp;макросы:<br>
<br>
*&nbsp;`CHECK`,&nbsp;`CHECK_FALSE`,&nbsp;`CHECK_EQ`,&nbsp;`CHECK_NEQ`,&nbsp;`CHECK_LT`,&nbsp;`CHECK_GT`<br>
*&nbsp;`REQUIRE`,&nbsp;`REQUIRE_FALSE`,&nbsp;`REQUIRE_EQ`,&nbsp;`REQUIRE_NEQ`,&nbsp;`REQUIRE_LT`,&nbsp;`REQUIRE_GT`<br>
*&nbsp;`FAIL`<br>
<br>
Если&nbsp;нужны&nbsp;только&nbsp;низкоуровневые&nbsp;`GUARD_*`-макросы&nbsp;без&nbsp;алиасов:<br>
<br>
```cpp<br>
#define&nbsp;GUARD_TEST_NO_CHECK_ALIASES<br>
#include&nbsp;&quot;guard.h&quot;<br>
```<br>
<br>
Тогда&nbsp;используются&nbsp;только&nbsp;`GUARD_CHECK`,&nbsp;`GUARD_REQUIRE`&nbsp;и&nbsp;т.п.<br>
<br>
---<br>
<br>
###&nbsp;Низкоуровневый&nbsp;API<br>
<br>
Макросы&nbsp;проверок&nbsp;(если&nbsp;алиасы&nbsp;отключены):<br>
<br>
*&nbsp;`GUARD_CHECK(expr)`<br>
*&nbsp;`GUARD_REQUIRE(expr)`<br>
*&nbsp;`GUARD_CHECK_FALSE(expr)`<br>
*&nbsp;`GUARD_REQUIRE_FALSE(expr)`<br>
*&nbsp;`GUARD_CHECK_EQ(a,&nbsp;b)`<br>
*&nbsp;`GUARD_REQUIRE_EQ(a,&nbsp;b)`<br>
*&nbsp;`GUARD_CHECK_NEQ(a,&nbsp;b)`<br>
*&nbsp;`GUARD_REQUIRE_NEQ(a,&nbsp;b)`<br>
*&nbsp;`GUARD_CHECK_LT(a,&nbsp;b)`<br>
*&nbsp;`GUARD_REQUIRE_LT(a,&nbsp;b)`<br>
*&nbsp;`GUARD_CHECK_GT(a,&nbsp;b)`<br>
*&nbsp;`GUARD_REQUIRE_GT(a,&nbsp;b)`<br>
<br>
Служебные&nbsp;макросы&nbsp;и&nbsp;функции&nbsp;для&nbsp;интеграции&nbsp;(обычно&nbsp;не&nbsp;нужны&nbsp;пользователю):<br>
<br>
*&nbsp;управление&nbsp;«окружением»&nbsp;проверки&nbsp;(start/error&nbsp;handler,&nbsp;добавление/установка&nbsp;сообщения&nbsp;об&nbsp;ошибке,&nbsp;принудительный&nbsp;выход&nbsp;из&nbsp;теста);<br>
*&nbsp;макросы&nbsp;для&nbsp;форматирования&nbsp;строки&nbsp;с&nbsp;текущим&nbsp;местом&nbsp;(`файл/строка/функция`);<br>
*&nbsp;макросы&nbsp;для&nbsp;склейки&nbsp;и&nbsp;строкизации&nbsp;идентификаторов.<br>
<br>
---<br>
<br>
##&nbsp;Внутреннее&nbsp;устройство&nbsp;(коротко)<br>
<br>
1.&nbsp;**Объявление&nbsp;тестов**<br>
&nbsp;&nbsp;&nbsp;Каждый&nbsp;`TEST_CASE`&nbsp;разворачивается&nbsp;в&nbsp;обычную&nbsp;функцию&nbsp;и&nbsp;автоматику&nbsp;регистрации,&nbsp;которая&nbsp;добавляет&nbsp;тест&nbsp;в&nbsp;глобальный&nbsp;список&nbsp;при&nbsp;старте&nbsp;программы.<br>
<br>
2.&nbsp;**Запуск**<br>
&nbsp;&nbsp;&nbsp;Раннер&nbsp;проходит&nbsp;по&nbsp;списку&nbsp;тестов,&nbsp;учитывая&nbsp;опциональный&nbsp;фильтр&nbsp;по&nbsp;имени,&nbsp;и&nbsp;последовательно&nbsp;запускает&nbsp;каждый&nbsp;тест,&nbsp;печатая&nbsp;статус&nbsp;и&nbsp;сводную&nbsp;статистику.<br>
<br>
3.&nbsp;**Контроль&nbsp;выполнения**<br>
&nbsp;&nbsp;&nbsp;&nbsp;Каждый&nbsp;`TEST_CASE`&nbsp;выполняется&nbsp;внутри&nbsp;защищённого&nbsp;блока,&nbsp;построенного&nbsp;на&nbsp;внутренних&nbsp;исключениях:<br>
&nbsp;&nbsp;&nbsp;&nbsp;мягкие&nbsp;проверки&nbsp;только&nbsp;копят&nbsp;сообщения,&nbsp;жёсткие&nbsp;—&nbsp;бросают&nbsp;специальное&nbsp;исключение&nbsp;и&nbsp;мгновенно&nbsp;прерывают&nbsp;тест,&nbsp;а&nbsp;раннер&nbsp;ловит&nbsp;его&nbsp;и&nbsp;печатает&nbsp;накопленные&nbsp;ошибки.<br>
<br>
4.&nbsp;**Ошибки&nbsp;и&nbsp;сообщения**<br>
&nbsp;&nbsp;&nbsp;Все&nbsp;сообщения&nbsp;по&nbsp;тесту&nbsp;собираются&nbsp;в&nbsp;одну&nbsp;строку;&nbsp;по&nbsp;окончании&nbsp;теста&nbsp;она&nbsp;либо&nbsp;пуста&nbsp;(успех),&nbsp;либо&nbsp;печатается&nbsp;целиком&nbsp;(провал).&nbsp;В&nbsp;эту&nbsp;же&nbsp;систему&nbsp;попадают&nbsp;«неожиданные»&nbsp;исключения,&nbsp;превращаясь&nbsp;в&nbsp;понятные&nbsp;текстовые&nbsp;ошибки.<br>
<br>
5.&nbsp;**Портируемость**<br>
&nbsp;&nbsp;&nbsp;Внутри&nbsp;используется&nbsp;только&nbsp;стандартный&nbsp;C/C++&nbsp;(без&nbsp;потоков,&nbsp;без&nbsp;платформенных&nbsp;API),&nbsp;поэтому&nbsp;код&nbsp;должен&nbsp;собираться&nbsp;везде,&nbsp;где&nbsp;есть&nbsp;нормальный&nbsp;компилятор&nbsp;C++11.<br>
<br>
```<br>
<!-- END SCAT CODE -->
</body>
</html>
