<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>tests/guard/README.md</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
#&nbsp;guard<br>
<br>
Однопоточный&nbsp;header-only&nbsp;кроссплатформенный&nbsp;тестовый&nbsp;фреймворк,&nbsp;по&nbsp;синтаксису&nbsp;близок&nbsp;к&nbsp;облегчённому&nbsp;doctest.&nbsp;Требуется&nbsp;C++11+.<br>
<br>
##&nbsp;Минимальный&nbsp;пример<br>
<br>
```cpp<br>
#include&nbsp;&quot;guard.h&quot;<br>
#include&nbsp;&lt;stdexcept&gt;<br>
<br>
TEST_CASE(&quot;simple&nbsp;arithmetic&quot;)&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;CHECK_EQ(2&nbsp;+&nbsp;2,&nbsp;4);<br>
&nbsp;&nbsp;&nbsp;&nbsp;CHECK_LT(1,&nbsp;10);<br>
}<br>
<br>
GUARD_TEST_MAIN();<br>
```<br>
<br>
Примеры&nbsp;использования&nbsp;смотрите&nbsp;в&nbsp;документации&nbsp;doctest&nbsp;—&nbsp;синтаксис&nbsp;и&nbsp;семантика&nbsp;максимально&nbsp;похожи.<br>
<br>
---<br>
<br>
##&nbsp;API<br>
<br>
###&nbsp;Объявление&nbsp;тестов&nbsp;и&nbsp;запуск<br>
<br>
-&nbsp;`TEST_CASE(&quot;name&quot;)`&nbsp;—&nbsp;объявляет&nbsp;и&nbsp;регистрирует&nbsp;тест&nbsp;с&nbsp;указанным&nbsp;именем.<br>
-&nbsp;`GUARD_TEST_MAIN()`&nbsp;—&nbsp;генерирует&nbsp;`main`&nbsp;и&nbsp;запускает&nbsp;все&nbsp;зарегистрированные&nbsp;тесты.&nbsp;Поддерживает&nbsp;фильтр&nbsp;по&nbsp;подстроке&nbsp;имени&nbsp;теста:&nbsp;`--test-case=Substring`&nbsp;или&nbsp;`--test-case&nbsp;Substring`.<br>
-&nbsp;`guard::test::run_all(const&nbsp;char&nbsp;*test_filter&nbsp;=&nbsp;nullptr,&nbsp;std::ostream&nbsp;&amp;os&nbsp;=&nbsp;std::cout)`&nbsp;—&nbsp;низкоуровневый&nbsp;запускатель&nbsp;тестов&nbsp;(альтернатива&nbsp;`GUARD_TEST_MAIN`).<br>
<br>
###&nbsp;Макросы&nbsp;проверок&nbsp;(алиасы,&nbsp;включены&nbsp;по&nbsp;умолчанию)<br>
<br>
Мягкие&nbsp;(soft,&nbsp;не&nbsp;рвут&nbsp;тест,&nbsp;только&nbsp;копят&nbsp;ошибки):<br>
<br>
-&nbsp;`CHECK(expr)`<br>
-&nbsp;`CHECK_FALSE(expr)`<br>
-&nbsp;`CHECK_EQ(a,&nbsp;b)`&nbsp;—&nbsp;ожидание&nbsp;`a&nbsp;==&nbsp;b`<br>
-&nbsp;`CHECK_NEQ(a,&nbsp;b)`&nbsp;—&nbsp;ожидание&nbsp;`a&nbsp;!=&nbsp;b`<br>
-&nbsp;`CHECK_LT(a,&nbsp;b)`&nbsp;—&nbsp;ожидание&nbsp;`a&nbsp;&lt;&nbsp;b`<br>
-&nbsp;`CHECK_GT(a,&nbsp;b)`&nbsp;—&nbsp;ожидание&nbsp;`a&nbsp;&gt;&nbsp;b`<br>
<br>
Жёсткие&nbsp;(hard,&nbsp;немедленно&nbsp;останавливают&nbsp;текущий&nbsp;тест):<br>
<br>
-&nbsp;`REQUIRE(expr)`<br>
-&nbsp;`REQUIRE_FALSE(expr)`<br>
-&nbsp;`REQUIRE_EQ(a,&nbsp;b)`<br>
-&nbsp;`REQUIRE_NEQ(a,&nbsp;b)`<br>
-&nbsp;`REQUIRE_LT(a,&nbsp;b)`<br>
-&nbsp;`REQUIRE_GT(a,&nbsp;b)`<br>
<br>
Для&nbsp;сравнительных&nbsp;макросов&nbsp;в&nbsp;сообщении&nbsp;об&nbsp;ошибке&nbsp;указываются&nbsp;файл/строка/функция,&nbsp;исходное&nbsp;выражение&nbsp;и&nbsp;значения&nbsp;левой&nbsp;и&nbsp;правой&nbsp;части&nbsp;(через&nbsp;`operator&lt;&lt;`).<br>
<br>
###&nbsp;Исключения<br>
<br>
Все&nbsp;проверки&nbsp;ниже&nbsp;фатальные:&nbsp;при&nbsp;нарушении&nbsp;ожиданий&nbsp;текущий&nbsp;тест&nbsp;сразу&nbsp;завершается.<br>
<br>
-&nbsp;`CHECK_THROWS(code)`&nbsp;—&nbsp;ожидается&nbsp;любое&nbsp;исключение.<br>
-&nbsp;`CHECK_THROWS_AS(code,&nbsp;ExType)`&nbsp;—&nbsp;ожидается&nbsp;исключение&nbsp;типа&nbsp;`ExType`.<br>
-&nbsp;`CHECK_NOTHROW(code)`&nbsp;—&nbsp;ожидается&nbsp;отсутствие&nbsp;исключений.<br>
<br>
###&nbsp;Таймаут<br>
<br>
-&nbsp;`CHECK_TIMEOUT(code,&nbsp;ms)`&nbsp;—&nbsp;выполняет&nbsp;`code`,&nbsp;измеряет&nbsp;длительность,&nbsp;сравнивает&nbsp;с&nbsp;лимитом&nbsp;`ms`&nbsp;(миллисекунды).&nbsp;При&nbsp;превышении&nbsp;лимита&nbsp;—&nbsp;фатальный&nbsp;провал&nbsp;с&nbsp;отчётом&nbsp;о&nbsp;фактическом&nbsp;времени.<br>
<br>
###&nbsp;Явный&nbsp;провал<br>
<br>
-&nbsp;`FAIL(message)`&nbsp;—&nbsp;помечает&nbsp;тест&nbsp;как&nbsp;проваленный&nbsp;с&nbsp;указанным&nbsp;сообщением&nbsp;и&nbsp;немедленно&nbsp;его&nbsp;завершает.<br>
<br>
###&nbsp;Приближённые&nbsp;сравнения<br>
<br>
Класс&nbsp;`guard::Approx`&nbsp;(из&nbsp;`util.h`)&nbsp;для&nbsp;сравнения&nbsp;чисел&nbsp;с&nbsp;допуском:<br>
<br>
-&nbsp;`Approx(double&nbsp;value)`&nbsp;—&nbsp;целевое&nbsp;значение.<br>
-&nbsp;`Approx&amp;&nbsp;epsilon(double&nbsp;eps)`&nbsp;—&nbsp;относительная&nbsp;погрешность.<br>
-&nbsp;`Approx&amp;&nbsp;scale(double&nbsp;s)`&nbsp;—&nbsp;масштаб&nbsp;(аналогично&nbsp;doctest/Catch2).<br>
-&nbsp;`Approx&nbsp;operator()(double&nbsp;value)&nbsp;const`&nbsp;—&nbsp;создание&nbsp;копии&nbsp;с&nbsp;новым&nbsp;значением.<br>
<br>
Поддерживаются&nbsp;сравнения:&nbsp;`x&nbsp;==&nbsp;Approx(...)`,&nbsp;`Approx(...)&nbsp;==&nbsp;x`,&nbsp;`x&nbsp;!=&nbsp;Approx(...)`,&nbsp;`Approx(...)&nbsp;!=&nbsp;x`.&nbsp;Числа&nbsp;считаются&nbsp;равными,&nbsp;если&nbsp;модуль&nbsp;разницы&nbsp;не&nbsp;превосходит&nbsp;рассчитанного&nbsp;допуска.<br>
<br>
###&nbsp;Конфигурация&nbsp;алиасов<br>
<br>
По&nbsp;умолчанию&nbsp;`guard.h`&nbsp;объявляет&nbsp;макросы:<br>
<br>
-&nbsp;`CHECK`,&nbsp;`CHECK_FALSE`,&nbsp;`CHECK_EQ`,&nbsp;`CHECK_NEQ`,&nbsp;`CHECK_LT`,&nbsp;`CHECK_GT`<br>
-&nbsp;`REQUIRE`,&nbsp;`REQUIRE_FALSE`,&nbsp;`REQUIRE_EQ`,&nbsp;`REQUIRE_NEQ`,&nbsp;`REQUIRE_LT`,&nbsp;`REQUIRE_GT`<br>
-&nbsp;`FAIL`<br>
<br>
Если&nbsp;нужны&nbsp;только&nbsp;низкоуровневые&nbsp;`GUARD_*`-макросы&nbsp;без&nbsp;алиасов:<br>
<br>
```cpp<br>
#define&nbsp;GUARD_TEST_NO_CHECK_ALIASES<br>
#include&nbsp;&quot;guard.h&quot;<br>
```<br>
<br>
Тогда&nbsp;используются&nbsp;только&nbsp;`GUARD_CHECK`,&nbsp;`GUARD_REQUIRE`&nbsp;и&nbsp;т.п.<br>
<br>
###&nbsp;Цветной&nbsp;вывод<br>
<br>
Цвета&nbsp;отключены&nbsp;по&nbsp;умолчанию.&nbsp;Чтобы&nbsp;включить,&nbsp;определите&nbsp;макрос&nbsp;**до**&nbsp;подключения&nbsp;`guard.h`&nbsp;(или&nbsp;передайте&nbsp;`-DGUARD_TEST_ENABLE_COLORS`&nbsp;компилятору):<br>
<br>
```cpp<br>
#define&nbsp;GUARD_TEST_ENABLE_COLORS<br>
#include&nbsp;&quot;guard.h&quot;<br>
```<br>
<br>
###&nbsp;Низкоуровневый&nbsp;API<br>
<br>
Макросы&nbsp;проверок&nbsp;(когда&nbsp;алиасы&nbsp;отключены):<br>
<br>
-&nbsp;`GUARD_CHECK(expr)`&nbsp;/&nbsp;`GUARD_REQUIRE(expr)`<br>
-&nbsp;`GUARD_CHECK_FALSE(expr)`&nbsp;/&nbsp;`GUARD_REQUIRE_FALSE(expr)`<br>
-&nbsp;`GUARD_CHECK_EQ(a,&nbsp;b)`&nbsp;/&nbsp;`GUARD_REQUIRE_EQ(a,&nbsp;b)`<br>
-&nbsp;`GUARD_CHECK_NEQ(a,&nbsp;b)`&nbsp;/&nbsp;`GUARD_REQUIRE_NEQ(a,&nbsp;b)`<br>
-&nbsp;`GUARD_CHECK_LT(a,&nbsp;b)`&nbsp;/&nbsp;`GUARD_REQUIRE_LT(a,&nbsp;b)`<br>
-&nbsp;`GUARD_CHECK_GT(a,&nbsp;b)`&nbsp;/&nbsp;`GUARD_REQUIRE_GT(a,&nbsp;b)`<br>
<br>
Служебные&nbsp;макросы&nbsp;и&nbsp;функции&nbsp;для&nbsp;интеграции&nbsp;(обычно&nbsp;не&nbsp;нужны&nbsp;пользователю):&nbsp;управление&nbsp;окружением&nbsp;проверки&nbsp;(start/error&nbsp;handler,&nbsp;добавление/установка&nbsp;сообщения,&nbsp;принудительный&nbsp;выход&nbsp;из&nbsp;теста);&nbsp;макросы&nbsp;для&nbsp;форматирования&nbsp;текущего&nbsp;места&nbsp;(файл/строка/функция);&nbsp;макросы&nbsp;для&nbsp;склейки&nbsp;и&nbsp;строкизации&nbsp;идентификаторов.<br>
<br>
---<br>
<br>
##&nbsp;Внутреннее&nbsp;устройство&nbsp;(коротко)<br>
<br>
1.&nbsp;**Объявление&nbsp;тестов**:&nbsp;каждый&nbsp;`TEST_CASE`&nbsp;разворачивается&nbsp;в&nbsp;функцию&nbsp;и&nbsp;автоматику&nbsp;регистрации,&nbsp;которая&nbsp;добавляет&nbsp;тест&nbsp;в&nbsp;глобальный&nbsp;список&nbsp;при&nbsp;старте&nbsp;программы.<br>
2.&nbsp;**Запуск**:&nbsp;раннер&nbsp;проходит&nbsp;по&nbsp;списку&nbsp;тестов&nbsp;(с&nbsp;учётом&nbsp;фильтра&nbsp;по&nbsp;имени)&nbsp;и&nbsp;последовательно&nbsp;запускает&nbsp;каждый,&nbsp;печатая&nbsp;статус&nbsp;и&nbsp;сводную&nbsp;статистику.<br>
3.&nbsp;**Контроль&nbsp;выполнения**:&nbsp;каждый&nbsp;`TEST_CASE`&nbsp;выполняется&nbsp;внутри&nbsp;защищённого&nbsp;блока&nbsp;на&nbsp;внутренних&nbsp;исключениях&nbsp;—&nbsp;мягкие&nbsp;проверки&nbsp;копят&nbsp;сообщения,&nbsp;жёсткие&nbsp;бросают&nbsp;специальное&nbsp;исключение&nbsp;и&nbsp;прерывают&nbsp;тест,&nbsp;а&nbsp;раннер&nbsp;ловит&nbsp;его&nbsp;и&nbsp;печатает&nbsp;накопленные&nbsp;ошибки.<br>
4.&nbsp;**Ошибки&nbsp;и&nbsp;сообщения**:&nbsp;все&nbsp;сообщения&nbsp;по&nbsp;тесту&nbsp;собираются&nbsp;в&nbsp;одну&nbsp;строку;&nbsp;по&nbsp;окончании&nbsp;она&nbsp;либо&nbsp;пуста&nbsp;(успех),&nbsp;либо&nbsp;печатается&nbsp;целиком&nbsp;(провал).&nbsp;Неожиданные&nbsp;исключения&nbsp;также&nbsp;переводятся&nbsp;в&nbsp;понятные&nbsp;текстовые&nbsp;ошибки.<br>
5.&nbsp;**Портируемость**:&nbsp;используется&nbsp;только&nbsp;стандартный&nbsp;C/C++&nbsp;(без&nbsp;потоков&nbsp;и&nbsp;платформенных&nbsp;API),&nbsp;поэтому&nbsp;код&nbsp;собирается&nbsp;везде,&nbsp;где&nbsp;есть&nbsp;нормальный&nbsp;компилятор&nbsp;C++11.<br>
<!-- END SCAT CODE -->
</body>
</html>
