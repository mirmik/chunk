<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>src/symbols.h</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
#pragma&nbsp;once&#13;
&#13;
#include&nbsp;&lt;cstddef&gt;&#13;
#include&nbsp;&lt;string&gt;&#13;
#include&nbsp;&lt;vector&gt;&#13;
&#13;
//&nbsp;Диапазон&nbsp;строк&nbsp;в&nbsp;файле&nbsp;(0-based,&nbsp;включительно).&#13;
struct&nbsp;Region&#13;
{&#13;
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;start_line&nbsp;=&nbsp;-1;&nbsp;//&nbsp;inclusive&#13;
&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;end_line&nbsp;=&nbsp;-1;&nbsp;&nbsp;&nbsp;//&nbsp;inclusive&#13;
};&#13;
&#13;
//&nbsp;Простейший&nbsp;поисковик&nbsp;C++-символов.&#13;
//&nbsp;Умеет:&#13;
//&nbsp;&nbsp;&nbsp;*&nbsp;находить&nbsp;определение&nbsp;класса&nbsp;(class&nbsp;/&nbsp;struct)&#13;
//&nbsp;&nbsp;&nbsp;*&nbsp;искать&nbsp;методы&nbsp;внутри&nbsp;класса&nbsp;(по&nbsp;имени)&#13;
class&nbsp;CppSymbolFinder&#13;
{&#13;
public:&#13;
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;text&nbsp;—&nbsp;полный&nbsp;текст&nbsp;файла.&#13;
&nbsp;&nbsp;&nbsp;&nbsp;explicit&nbsp;CppSymbolFinder(const&nbsp;std::string&nbsp;&amp;text);&#13;
&#13;
&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;std::vector&lt;std::string&gt;&nbsp;&amp;lines()&nbsp;const&#13;
&nbsp;&nbsp;&nbsp;&nbsp;{&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;m_lines;&#13;
&nbsp;&nbsp;&nbsp;&nbsp;}&#13;
&#13;
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Находит&nbsp;определение&nbsp;класса&nbsp;(НЕ&nbsp;forward-declaration).&#13;
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Возвращает&nbsp;true,&nbsp;если&nbsp;класс&nbsp;найден.&#13;
&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;find_class(const&nbsp;std::string&nbsp;&amp;class_name,&nbsp;Region&nbsp;&amp;out)&nbsp;const;&#13;
&#13;
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Находит&nbsp;метод&nbsp;внутри&nbsp;класса&nbsp;(по&nbsp;имени).&#13;
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Ищет&nbsp;только&nbsp;внутри&nbsp;тела&nbsp;class/struct&nbsp;class_name.&#13;
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Возвращает&nbsp;диапазон&nbsp;строк&nbsp;от&nbsp;начала&nbsp;объявления/определения&#13;
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;до&nbsp;';'&nbsp;или&nbsp;закрывающей&nbsp;'}'.&#13;
&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;find_method(const&nbsp;std::string&nbsp;&amp;class_name,&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;std::string&nbsp;&amp;method_name,&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Region&nbsp;&amp;out)&nbsp;const;&#13;
&#13;
private:&#13;
&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;Token&#13;
&nbsp;&nbsp;&nbsp;&nbsp;{&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;enum&nbsp;Kind&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Identifier,&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Keyword,&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Symbol&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}&nbsp;kind;&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;std::string&nbsp;text;&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;line&nbsp;=&nbsp;0;&nbsp;//&nbsp;0-based&#13;
&nbsp;&nbsp;&nbsp;&nbsp;};&#13;
&#13;
&nbsp;&nbsp;&nbsp;&nbsp;struct&nbsp;ClassRange&#13;
&nbsp;&nbsp;&nbsp;&nbsp;{&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Region&nbsp;region;&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;std::size_t&nbsp;body_start_token&nbsp;=&nbsp;0;&nbsp;//&nbsp;индекс&nbsp;'{'&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;std::size_t&nbsp;body_end_token&nbsp;=&nbsp;0;&nbsp;&nbsp;&nbsp;//&nbsp;индекс&nbsp;'}'&nbsp;(или&nbsp;'};')&#13;
&nbsp;&nbsp;&nbsp;&nbsp;};&#13;
&#13;
&nbsp;&nbsp;&nbsp;&nbsp;std::vector&lt;std::string&gt;&nbsp;m_lines;&#13;
&nbsp;&nbsp;&nbsp;&nbsp;std::vector&lt;Token&gt;&nbsp;m_tokens;&#13;
&#13;
&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;tokenize(const&nbsp;std::string&nbsp;&amp;text);&#13;
&#13;
&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;bool&nbsp;is_ident_start(char&nbsp;c);&#13;
&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;bool&nbsp;is_ident_char(char&nbsp;c);&#13;
&#13;
&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;find_class_internal(const&nbsp;std::string&nbsp;&amp;class_name,&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;ClassRange&nbsp;&amp;out)&nbsp;const;&#13;
};&#13;
&#13;
//&nbsp;Простейший&nbsp;поисковик&nbsp;Python-символов.&#13;
//&nbsp;Умеет:&#13;
//&nbsp;&nbsp;&nbsp;*&nbsp;находить&nbsp;определение&nbsp;класса&nbsp;(class&nbsp;Foo:)&#13;
//&nbsp;&nbsp;&nbsp;*&nbsp;искать&nbsp;методы&nbsp;внутри&nbsp;класса&nbsp;(def&nbsp;bar(self,&nbsp;...))&#13;
class&nbsp;PythonSymbolFinder&#13;
{&#13;
public:&#13;
&nbsp;&nbsp;&nbsp;&nbsp;explicit&nbsp;PythonSymbolFinder(const&nbsp;std::string&nbsp;&amp;text);&#13;
&#13;
&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;std::vector&lt;std::string&gt;&nbsp;&amp;lines()&nbsp;const&#13;
&nbsp;&nbsp;&nbsp;&nbsp;{&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;m_lines;&#13;
&nbsp;&nbsp;&nbsp;&nbsp;}&#13;
&#13;
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Находит&nbsp;определение&nbsp;класса&nbsp;(первое&nbsp;вхождение&nbsp;с&nbsp;таким&nbsp;именем).&#13;
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Region&nbsp;покрывает&nbsp;строку&nbsp;'class&nbsp;...'&nbsp;и&nbsp;всё&nbsp;тело&nbsp;класса&nbsp;до&nbsp;dedent.&#13;
&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;find_class(const&nbsp;std::string&nbsp;&amp;class_name,&nbsp;Region&nbsp;&amp;out)&nbsp;const;&#13;
&#13;
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Находит&nbsp;метод&nbsp;внутри&nbsp;класса.&#13;
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Ищет&nbsp;def&nbsp;/&nbsp;async&nbsp;def&nbsp;с&nbsp;именем&nbsp;method_name,&#13;
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;являющийся&nbsp;&quot;первым&nbsp;уровнем&quot;&nbsp;внутри&nbsp;тела&nbsp;class_name.&#13;
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Region&nbsp;покрывает&nbsp;строку&nbsp;def&nbsp;(включая&nbsp;декораторы&nbsp;над&nbsp;ней)&nbsp;и&nbsp;всё&nbsp;тело&nbsp;до&#13;
&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;dedent.&#13;
&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;find_method(const&nbsp;std::string&nbsp;&amp;class_name,&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;const&nbsp;std::string&nbsp;&amp;method_name,&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Region&nbsp;&amp;out)&nbsp;const;&#13;
&#13;
private:&#13;
&nbsp;&nbsp;&nbsp;&nbsp;std::vector&lt;std::string&gt;&nbsp;m_lines;&#13;
&#13;
&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;int&nbsp;calc_indent(const&nbsp;std::string&nbsp;&amp;line);&#13;
&nbsp;&nbsp;&nbsp;&nbsp;static&nbsp;std::size_t&nbsp;first_code_pos(const&nbsp;std::string&nbsp;&amp;line);&#13;
&#13;
&nbsp;&nbsp;&nbsp;&nbsp;bool&nbsp;find_class_internal(const&nbsp;std::string&nbsp;&amp;class_name,&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;Region&nbsp;&amp;out,&#13;
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;&amp;class_indent)&nbsp;const;&#13;
};&#13;
<!-- END SCAT CODE -->
</body>
</html>
