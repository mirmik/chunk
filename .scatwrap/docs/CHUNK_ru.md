<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>docs/CHUNK_ru.md</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
#&nbsp;Формат&nbsp;патчей&nbsp;CHUNK<br>
<br>
Формат&nbsp;CHUNK&nbsp;задуман&nbsp;c&nbsp;тем,&nbsp;чтобы<br>
<br>
*&nbsp;быть&nbsp;достаточно&nbsp;простым&nbsp;для&nbsp;чтения&nbsp;человеком&nbsp;и&nbsp;генерации&nbsp;нейросетью;<br>
*&nbsp;и&nbsp;достаточно&nbsp;строгим,&nbsp;чтобы&nbsp;безопасно&nbsp;модифицировать&nbsp;исходный&nbsp;код.<br>
<br>
В&nbsp;этом&nbsp;файле&nbsp;описываем&nbsp;**формат&nbsp;файла&nbsp;и&nbsp;семантику&nbsp;команд**.&nbsp;&nbsp;<br>
CHUNK&nbsp;использует&nbsp;облегчённый&nbsp;YAML-синтаксис,&nbsp;потому&nbsp;что&nbsp;нейросети&nbsp;достаточно&nbsp;стабильно&nbsp;пишут&nbsp;YAML-документы&nbsp;(в&nbsp;отличие&nbsp;от&nbsp;unified&nbsp;diff).<br>
<br>
---<br>
<br>
##&nbsp;1.&nbsp;Структура&nbsp;файла<br>
<br>
Корень&nbsp;YAML-документа&nbsp;—&nbsp;**объект**&nbsp;с&nbsp;обязательным&nbsp;полем&nbsp;`operations`:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.py<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;...<br>
```<br>
<br>
Также&nbsp;опционально,&nbsp;но&nbsp;весьма&nbsp;желательно&nbsp;добавить&nbsp;описание&nbsp;`description`&nbsp;и&nbsp;язык&nbsp;программирования&nbsp;`language`&nbsp;(поддерживаются&nbsp;`c++`&nbsp;и&nbsp;`python`):<br>
<br>
```yaml<br>
description:&nbsp;&quot;Краткое&nbsp;описание&nbsp;патча&quot;<br>
language:&nbsp;c++<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;...<br>
```<br>
<br>
*&nbsp;`operations`&nbsp;—&nbsp;массив&nbsp;операций.<br>
*&nbsp;каждый&nbsp;элемент&nbsp;массива&nbsp;—&nbsp;отдельная&nbsp;операция,&nbsp;причём&nbsp;операции&nbsp;применяются&nbsp;**в&nbsp;порядке**&nbsp;изложения&nbsp;в&nbsp;документе.<br>
<br>
Кроме&nbsp;этого,&nbsp;у&nbsp;каждой&nbsp;операции&nbsp;можно&nbsp;задать&nbsp;необязательное&nbsp;поле&nbsp;`comment`&nbsp;с&nbsp;произвольным&nbsp;описанием:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;comment:&nbsp;&quot;Локальная&nbsp;заметка&nbsp;к&nbsp;операции&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;...<br>
```<br>
<br>
Поле&nbsp;`comment`&nbsp;не&nbsp;влияет&nbsp;на&nbsp;применение&nbsp;патча&nbsp;и&nbsp;служит&nbsp;только&nbsp;для&nbsp;пояснений.<br>
<br>
---<br>
<br>
##&nbsp;2.&nbsp;Маркеры,&nbsp;whitespace,&nbsp;игнорирование&nbsp;комментариев<br>
<br>
Для&nbsp;текстовых&nbsp;и&nbsp;блоковых&nbsp;команд&nbsp;используются&nbsp;поля:<br>
<br>
*&nbsp;`marker`&nbsp;—&nbsp;основной&nbsp;фрагмент&nbsp;для&nbsp;поиска;<br>
*&nbsp;`before`&nbsp;—&nbsp;контекст&nbsp;до&nbsp;маркера&nbsp;(опционально);<br>
*&nbsp;`after`&nbsp;—&nbsp;контекст&nbsp;после&nbsp;маркера&nbsp;(опционально).<br>
<br>
Последние&nbsp;два&nbsp;—&nbsp;опциональны.&nbsp;Они&nbsp;могут&nbsp;быть&nbsp;использованы&nbsp;для&nbsp;уточнения&nbsp;маркера,&nbsp;если&nbsp;в&nbsp;файле&nbsp;есть&nbsp;повторы.&nbsp;&nbsp;<br>
Все&nbsp;три&nbsp;поля&nbsp;—&nbsp;многострочные&nbsp;скаляры&nbsp;YAML&nbsp;(`|`&nbsp;/&nbsp;`|-`).<br>
<br>
###&nbsp;2.1.&nbsp;Поиск&nbsp;маркера<br>
<br>
При&nbsp;поиске&nbsp;маркера&nbsp;мы&nbsp;**игнорируем&nbsp;различия&nbsp;в&nbsp;отступах,&nbsp;хвостовых&nbsp;пробелах&nbsp;и&nbsp;количестве&nbsp;пустых&nbsp;строк**,&nbsp;чтобы&nbsp;патчи&nbsp;не&nbsp;ломались&nbsp;из-за&nbsp;форматирования&nbsp;различных&nbsp;версий&nbsp;IDE&nbsp;(интегрированная&nbsp;среда&nbsp;разработки)&nbsp;и&nbsp;веб-просмотрщиков,&nbsp;в&nbsp;том&nbsp;числе&nbsp;используемых&nbsp;нейросетями&nbsp;при&nbsp;просмотре&nbsp;интернет-ссылок.<br>
<br>
Также&nbsp;**игнорируются&nbsp;комментарии&nbsp;на&nbsp;том&nbsp;языке&nbsp;программирования,&nbsp;что&nbsp;указан&nbsp;в&nbsp;`language`**&nbsp;(`c++`&nbsp;или&nbsp;`python`).&nbsp;Это&nbsp;сделано&nbsp;потому,&nbsp;что&nbsp;нейросеть&nbsp;часто:<br>
<br>
*&nbsp;либо&nbsp;«глотает»&nbsp;комментарии&nbsp;при&nbsp;переписывании&nbsp;текста&nbsp;маркера&nbsp;—&nbsp;и&nbsp;тогда&nbsp;их&nbsp;нужно&nbsp;проигнорировать;<br>
*&nbsp;либо,&nbsp;наоборот,&nbsp;включает&nbsp;комментарий&nbsp;в&nbsp;маркер&nbsp;—&nbsp;и&nbsp;это&nbsp;тоже&nbsp;должно&nbsp;корректно&nbsp;обрабатываться.<br>
<br>
Правила&nbsp;обработки&nbsp;маркера:<br>
<br>
*&nbsp;удаляются&nbsp;пробелы&nbsp;и&nbsp;табы&nbsp;в&nbsp;начале&nbsp;и&nbsp;в&nbsp;конце&nbsp;строки;<br>
*&nbsp;игнорируются&nbsp;пустые&nbsp;строки;<br>
*&nbsp;результирующий&nbsp;диапазон&nbsp;`[begin,&nbsp;end]`&nbsp;рассчитывается&nbsp;по&nbsp;реальным&nbsp;строкам&nbsp;файла,&nbsp;включая&nbsp;выкинутые&nbsp;пустые.<br>
<br>
С&nbsp;точки&nbsp;зрения&nbsp;CHUNK&nbsp;следующие&nbsp;маркеры&nbsp;идентичны:<br>
<br>
```<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A<br>
<br>
B<br>
```<br>
<br>
и<br>
<br>
```<br>
A<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B<br>
```<br>
<br>
поскольку&nbsp;оба&nbsp;приводятся&nbsp;к&nbsp;каноничной&nbsp;форме:<br>
<br>
```<br>
A<br>
B<br>
```<br>
<br>
---<br>
<br>
##&nbsp;3.&nbsp;Отступы&nbsp;`payload`<br>
<br>
Отступы&nbsp;вставляемого&nbsp;текста&nbsp;по&nbsp;умолчанию&nbsp;выравниваются&nbsp;по&nbsp;идентации&nbsp;начала&nbsp;маркера,&nbsp;но&nbsp;это&nbsp;поведение&nbsp;можно&nbsp;изменить:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;value()&nbsp;const;<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;value()&nbsp;const&nbsp;noexcept;<br>
&nbsp;&nbsp;&nbsp;&nbsp;options:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indent:&nbsp;&lt;mode&gt;<br>
```<br>
<br>
Режимы:<br>
<br>
*&nbsp;`from-marker`&nbsp;/&nbsp;`marker`&nbsp;/&nbsp;`auto`&nbsp;—&nbsp;выровнять&nbsp;`payload`&nbsp;по&nbsp;отступу&nbsp;маркера&nbsp;&nbsp;<br>
&nbsp;&nbsp;(режим&nbsp;по&nbsp;умолчанию,&nbsp;если&nbsp;`options.indent`&nbsp;не&nbsp;указан);<br>
*&nbsp;`none`&nbsp;/&nbsp;`as-is`&nbsp;—&nbsp;оставить&nbsp;отступы&nbsp;`payload`&nbsp;«как&nbsp;есть»&nbsp;в&nbsp;соответствии&nbsp;с&nbsp;правилами&nbsp;YAML.<br>
<br>
Базовый&nbsp;отступ&nbsp;берётся:<br>
<br>
*&nbsp;для&nbsp;текстовых&nbsp;команд&nbsp;—&nbsp;из&nbsp;первой&nbsp;строки&nbsp;диапазона&nbsp;маркера;<br>
*&nbsp;для&nbsp;языковых&nbsp;команд&nbsp;(`replace_c_style_block`,&nbsp;`replace_py_block`)&nbsp;—&nbsp;из&nbsp;строки&nbsp;с&nbsp;«шапкой»&nbsp;блока&nbsp;(сигнатура&nbsp;функции,&nbsp;`if&nbsp;...`,&nbsp;`for&nbsp;...`,&nbsp;`def&nbsp;...`,&nbsp;`class&nbsp;...`&nbsp;и&nbsp;так&nbsp;далее).<br>
<br>
Отступ&nbsp;добавляется&nbsp;только&nbsp;к&nbsp;**непустым**&nbsp;строкам&nbsp;`payload`.<br>
<br>
---<br>
<br>
##&nbsp;4.&nbsp;Файловые&nbsp;команды<br>
<br>
###&nbsp;4.1.&nbsp;`create_file`<br>
<br>
Создать&nbsp;или&nbsp;перезаписать&nbsp;файл:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/hello.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;create_file<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#include&nbsp;&lt;iostream&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;main()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;std::cout&nbsp;&lt;&lt;&nbsp;&quot;Hello\n&quot;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
```<br>
<br>
*&nbsp;`path`&nbsp;—&nbsp;целевой&nbsp;файл.<br>
*&nbsp;`payload`&nbsp;—&nbsp;содержимое&nbsp;файла&nbsp;(может&nbsp;быть&nbsp;пустым&nbsp;→&nbsp;пустой&nbsp;файл).<br>
<br>
###&nbsp;4.2.&nbsp;`delete_file`<br>
<br>
Удалить&nbsp;файл:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/obsolete.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;delete_file<br>
```<br>
<br>
---<br>
<br>
##&nbsp;5.&nbsp;Текстовые&nbsp;команды<br>
<br>
Работают&nbsp;с&nbsp;произвольным&nbsp;текстом&nbsp;по&nbsp;маркеру.<br>
<br>
Обязательные&nbsp;поля&nbsp;операции:<br>
<br>
*&nbsp;`path`<br>
*&nbsp;`op:&nbsp;insert_after_text&nbsp;|&nbsp;insert_before_text&nbsp;|&nbsp;replace_text&nbsp;|&nbsp;delete_text&nbsp;|&nbsp;prepend_text&nbsp;|&nbsp;append_text`<br>
*&nbsp;`marker`&nbsp;—&nbsp;обязателен&nbsp;для&nbsp;маркерных&nbsp;операций&nbsp;(`insert_after_text`,&nbsp;`insert_before_text`,&nbsp;`replace_text`,&nbsp;`delete_text`).<br>
*&nbsp;`payload`&nbsp;—&nbsp;обязателен&nbsp;для&nbsp;всех,&nbsp;кроме&nbsp;`delete_text`;<br>
<br>
Для&nbsp;`prepend_text`&nbsp;и&nbsp;`append_text`&nbsp;поле&nbsp;`marker`&nbsp;не&nbsp;используется:&nbsp;они&nbsp;просто&nbsp;вставляют&nbsp;`payload`&nbsp;в&nbsp;начало&nbsp;или&nbsp;конец&nbsp;файла.<br>
<br>
Дополнительные:<br>
<br>
*&nbsp;`before`,&nbsp;`after`&nbsp;—&nbsp;опциональный&nbsp;контекст&nbsp;(указывают,&nbsp;что&nbsp;окружает&nbsp;маркер);<br>
*&nbsp;`comment`&nbsp;—&nbsp;опциональная&nbsp;человекочитаемая&nbsp;заметка&nbsp;к&nbsp;операции;<br>
*&nbsp;`options.indent`&nbsp;—&nbsp;опционально&nbsp;(см.&nbsp;раздел&nbsp;3).<br>
<br>
###&nbsp;5.1.&nbsp;`replace_text`<br>
<br>
Заменить&nbsp;фрагмент&nbsp;по&nbsp;маркеру:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;value()&nbsp;const;<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;value()&nbsp;const&nbsp;noexcept;<br>
```<br>
<br>
###&nbsp;5.2.&nbsp;`insert_after_text`<br>
<br>
Вставить&nbsp;текст&nbsp;сразу&nbsp;**после**&nbsp;маркера:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;insert_after_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;Foo::init()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do_stuff();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;Foo::log_state()&nbsp;const<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
```<br>
<br>
###&nbsp;5.3.&nbsp;`insert_before_text`<br>
<br>
Вставить&nbsp;текст&nbsp;**перед**&nbsp;маркером:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;insert_before_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;run();<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;debug_run();<br>
```<br>
<br>
###&nbsp;5.4.&nbsp;`delete_text`<br>
<br>
Удалить&nbsp;фрагмент&nbsp;по&nbsp;маркеру:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;delete_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#include&nbsp;&quot;debug.h&quot;<br>
```<br>
<br>
###&nbsp;5.5.&nbsp;`prepend_text`<br>
<br>
Вставить&nbsp;текст&nbsp;в&nbsp;начало&nbsp;файла&nbsp;без&nbsp;указания&nbsp;маркера:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;prepend_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Этот&nbsp;блок&nbsp;будет&nbsp;вставлен&nbsp;в&nbsp;самое&nbsp;начало&nbsp;файла.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;...<br>
```<br>
<br>
###&nbsp;5.6.&nbsp;`append_text`<br>
<br>
Вставить&nbsp;текст&nbsp;в&nbsp;конец&nbsp;файла&nbsp;без&nbsp;указания&nbsp;маркера:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;append_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;Этот&nbsp;блок&nbsp;будет&nbsp;добавлен&nbsp;в&nbsp;самый&nbsp;конец&nbsp;файла.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;...<br>
```<br>
<br>
---<br>
<br>
##&nbsp;6.&nbsp;Команды&nbsp;для&nbsp;C-подобных&nbsp;и&nbsp;Python-блоков<br>
<br>
Эти&nbsp;команды&nbsp;работают&nbsp;не&nbsp;с&nbsp;произвольным&nbsp;куском&nbsp;текста,&nbsp;а&nbsp;с&nbsp;**логическими&nbsp;блоками&nbsp;кода**&nbsp;(функции,&nbsp;методы,&nbsp;`if`/`for`-блоки&nbsp;и&nbsp;т.п.).<br>
<br>
Поддерживаемые&nbsp;команды:<br>
<br>
*&nbsp;`replace_c_style_block`<br>
*&nbsp;`replace_py_block`<br>
<br>
Общие&nbsp;поля:<br>
<br>
*&nbsp;`path`<br>
*&nbsp;`op`<br>
*&nbsp;`marker`&nbsp;—&nbsp;«шапка»&nbsp;блока&nbsp;(см.&nbsp;ниже);<br>
*&nbsp;`payload`&nbsp;—&nbsp;новый&nbsp;код&nbsp;блока&nbsp;целиком;<br>
*&nbsp;`before`,&nbsp;`after`&nbsp;—&nbsp;опциональный&nbsp;контекст&nbsp;вокруг&nbsp;маркера;<br>
*&nbsp;`comment`&nbsp;—&nbsp;человекочитаемая&nbsp;заметка&nbsp;к&nbsp;операции;<br>
*&nbsp;`options.indent`&nbsp;—&nbsp;режим&nbsp;отступов&nbsp;(как&nbsp;в&nbsp;разделе&nbsp;3).<br>
<br>
###&nbsp;6.1.&nbsp;C-подобный&nbsp;код:&nbsp;`replace_c_style_block`<br>
<br>
Заменяет&nbsp;C-подобный&nbsp;блок&nbsp;кода&nbsp;(функцию,&nbsp;метод,&nbsp;`if`-блок&nbsp;и&nbsp;т.п.),&nbsp;ограниченный&nbsp;фигурными&nbsp;скобками.<br>
<br>
*&nbsp;`marker`&nbsp;должен&nbsp;включать&nbsp;«шапку»&nbsp;блока&nbsp;от&nbsp;первой&nbsp;строки&nbsp;сигнатуры&nbsp;до&nbsp;строки&nbsp;с&nbsp;открывающей&nbsp;`{`.&nbsp;&nbsp;<br>
&nbsp;&nbsp;При&nbsp;поиске&nbsp;игнорируются&nbsp;комментарии&nbsp;и&nbsp;лишние&nbsp;пробелы&nbsp;так&nbsp;же,&nbsp;как&nbsp;в&nbsp;`replace_text`.<br>
*&nbsp;Область&nbsp;замены&nbsp;—&nbsp;от&nbsp;начала&nbsp;маркера&nbsp;до&nbsp;соответствующей&nbsp;закрывающей&nbsp;`}`.<br>
<br>
Пример:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_c_style_block<br>
&nbsp;&nbsp;&nbsp;&nbsp;comment:&nbsp;&quot;Обновляем&nbsp;реализацию&nbsp;Foo::value&nbsp;в&nbsp;C++&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;Foo::value()&nbsp;const<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;Foo::value()&nbsp;const<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;новая&nbsp;логика<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;42;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
```<br>
<br>
###&nbsp;6.2.&nbsp;Python-подобный&nbsp;код:&nbsp;`replace_py_block`<br>
<br>
Команда&nbsp;для&nbsp;Python-блоков,&nbsp;аналогичная&nbsp;`replace_c_style_block`,&nbsp;но&nbsp;вместо&nbsp;фигурных&nbsp;скобок&nbsp;использует&nbsp;двоеточие&nbsp;и&nbsp;отступы.<br>
<br>
*&nbsp;`marker`&nbsp;должен&nbsp;включать&nbsp;строку,&nbsp;где&nbsp;находится&nbsp;двоеточие,&nbsp;открывающее&nbsp;блок&nbsp;(`if&nbsp;...:`,&nbsp;`for&nbsp;...:`,&nbsp;`while&nbsp;...:`,&nbsp;`with&nbsp;...:`,&nbsp;`def&nbsp;...:`,&nbsp;`class&nbsp;...:`&nbsp;и&nbsp;т.д.).<br>
*&nbsp;Область&nbsp;замены&nbsp;—&nbsp;от&nbsp;начала&nbsp;маркера&nbsp;до&nbsp;конца&nbsp;блока,&nbsp;то&nbsp;есть&nbsp;до&nbsp;первой&nbsp;строки,&nbsp;чей&nbsp;отступ&nbsp;**не&nbsp;больше**,&nbsp;чем&nbsp;у&nbsp;строки&nbsp;с&nbsp;двоеточием.&nbsp;Пустые&nbsp;строки&nbsp;внутри&nbsp;блока&nbsp;допускаются&nbsp;и&nbsp;не&nbsp;обрывают&nbsp;его.<br>
*&nbsp;Остальные&nbsp;поля&nbsp;(`payload`,&nbsp;`before`,&nbsp;`after`,&nbsp;`options.indent`)&nbsp;работают&nbsp;так&nbsp;же,&nbsp;как&nbsp;у&nbsp;`replace_c_style_block`.<br>
<br>
Пример:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.py<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_py_block<br>
&nbsp;&nbsp;&nbsp;&nbsp;comment:&nbsp;&quot;Обновляем&nbsp;реализацию&nbsp;Foo.run&nbsp;в&nbsp;Python&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;run(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;run(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;value:&quot;,&nbsp;self.value)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.value<br>
```<br>
<br>
---<br>
<br>
##&nbsp;7.&nbsp;Пример&nbsp;цельного&nbsp;патча<br>
<br>
```yaml<br>
description:&nbsp;&quot;Обновить&nbsp;реализацию&nbsp;значения&nbsp;в&nbsp;C++&nbsp;и&nbsp;Python&quot;<br>
language:&nbsp;c++<br>
<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_c_style_block<br>
&nbsp;&nbsp;&nbsp;&nbsp;comment:&nbsp;&quot;Обновляем&nbsp;реализацию&nbsp;Foo::value&nbsp;в&nbsp;C++&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;Foo::value()&nbsp;const<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;Foo::value()&nbsp;const<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;42;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.py<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_py_block<br>
&nbsp;&nbsp;&nbsp;&nbsp;comment:&nbsp;&quot;Обновляем&nbsp;реализацию&nbsp;Foo.run&nbsp;в&nbsp;Python&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;run(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;run(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;value:&quot;,&nbsp;self.value)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.value<br>
```<br>
<!-- END SCAT CODE -->
</body>
</html>
