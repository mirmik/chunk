<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8">
  <title>docs/CHUNK_en.md</title>
</head>
<body>
<!-- BEGIN SCAT CODE -->
#&nbsp;CHUNK&nbsp;patch&nbsp;format<br>
<br>
The&nbsp;CHUNK&nbsp;format&nbsp;is&nbsp;designed&nbsp;to<br>
<br>
*&nbsp;be&nbsp;simple&nbsp;enough&nbsp;to&nbsp;be&nbsp;read&nbsp;by&nbsp;a&nbsp;human&nbsp;and&nbsp;generated&nbsp;by&nbsp;a&nbsp;neural&nbsp;network;<br>
*&nbsp;and&nbsp;strict&nbsp;enough&nbsp;to&nbsp;safely&nbsp;modify&nbsp;source&nbsp;code.<br>
<br>
This&nbsp;file&nbsp;describes&nbsp;the&nbsp;**file&nbsp;format&nbsp;and&nbsp;command&nbsp;semantics**.&nbsp;&nbsp;<br>
CHUNK&nbsp;uses&nbsp;a&nbsp;simplified&nbsp;YAML&nbsp;(YAML&nbsp;Ain't&nbsp;Markup&nbsp;Language)&nbsp;syntax&nbsp;because&nbsp;neural&nbsp;networks&nbsp;tend&nbsp;to&nbsp;generate&nbsp;YAML&nbsp;documents&nbsp;more&nbsp;reliably&nbsp;than&nbsp;unified&nbsp;diffs.<br>
<br>
---<br>
<br>
##&nbsp;1.&nbsp;File&nbsp;structure<br>
<br>
The&nbsp;root&nbsp;of&nbsp;a&nbsp;YAML&nbsp;document&nbsp;is&nbsp;an&nbsp;**object**&nbsp;with&nbsp;a&nbsp;required&nbsp;`operations`&nbsp;field:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;...<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.py<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;...<br>
```<br>
<br>
It&nbsp;is&nbsp;also&nbsp;optional,&nbsp;but&nbsp;highly&nbsp;recommended,&nbsp;to&nbsp;add&nbsp;a&nbsp;human&nbsp;description&nbsp;`description`&nbsp;and&nbsp;a&nbsp;programming&nbsp;language&nbsp;`language`&nbsp;(currently&nbsp;`c++`&nbsp;and&nbsp;`python`&nbsp;are&nbsp;supported):<br>
<br>
```yaml<br>
description:&nbsp;&quot;Short&nbsp;description&nbsp;of&nbsp;the&nbsp;patch&quot;<br>
language:&nbsp;c++<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;...<br>
```<br>
<br>
*&nbsp;`operations`&nbsp;—&nbsp;array&nbsp;of&nbsp;operations.<br>
*&nbsp;each&nbsp;element&nbsp;of&nbsp;the&nbsp;array&nbsp;is&nbsp;a&nbsp;separate&nbsp;operation;&nbsp;operations&nbsp;are&nbsp;applied&nbsp;**in&nbsp;the&nbsp;order**&nbsp;they&nbsp;appear&nbsp;in&nbsp;the&nbsp;document.<br>
<br>
Additionally,&nbsp;each&nbsp;operation&nbsp;can&nbsp;have&nbsp;an&nbsp;optional&nbsp;`comment`&nbsp;field&nbsp;with&nbsp;any&nbsp;description:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;comment:&nbsp;&quot;Local&nbsp;note&nbsp;for&nbsp;this&nbsp;operation&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;...<br>
```<br>
<br>
The&nbsp;`comment`&nbsp;field&nbsp;does&nbsp;not&nbsp;affect&nbsp;how&nbsp;the&nbsp;patch&nbsp;is&nbsp;applied&nbsp;and&nbsp;is&nbsp;only&nbsp;for&nbsp;explanations.<br>
<br>
---<br>
<br>
##&nbsp;2.&nbsp;Markers,&nbsp;whitespace,&nbsp;comment&nbsp;ignoring<br>
<br>
Text&nbsp;and&nbsp;block&nbsp;commands&nbsp;use&nbsp;the&nbsp;following&nbsp;fields:<br>
<br>
*&nbsp;`marker`&nbsp;—&nbsp;main&nbsp;fragment&nbsp;to&nbsp;search&nbsp;for;<br>
*&nbsp;`before`&nbsp;—&nbsp;context&nbsp;before&nbsp;the&nbsp;marker&nbsp;(optional);<br>
*&nbsp;`after`&nbsp;—&nbsp;context&nbsp;after&nbsp;the&nbsp;marker&nbsp;(optional).<br>
<br>
The&nbsp;last&nbsp;two&nbsp;are&nbsp;optional.&nbsp;They&nbsp;can&nbsp;be&nbsp;used&nbsp;to&nbsp;disambiguate&nbsp;a&nbsp;marker&nbsp;when&nbsp;there&nbsp;are&nbsp;duplicates&nbsp;in&nbsp;the&nbsp;file.&nbsp;&nbsp;<br>
All&nbsp;three&nbsp;fields&nbsp;are&nbsp;multiline&nbsp;YAML&nbsp;scalars&nbsp;(`|`&nbsp;/&nbsp;`|-`).<br>
<br>
###&nbsp;2.1.&nbsp;Marker&nbsp;search<br>
<br>
When&nbsp;searching&nbsp;for&nbsp;a&nbsp;marker&nbsp;we&nbsp;**ignore&nbsp;differences&nbsp;in&nbsp;indentation,&nbsp;trailing&nbsp;spaces,&nbsp;and&nbsp;the&nbsp;number&nbsp;of&nbsp;empty&nbsp;lines**,&nbsp;so&nbsp;that&nbsp;patches&nbsp;do&nbsp;not&nbsp;break&nbsp;due&nbsp;to&nbsp;formatting&nbsp;differences&nbsp;between&nbsp;various&nbsp;IDEs&nbsp;(integrated&nbsp;development&nbsp;environments)&nbsp;and&nbsp;web&nbsp;viewers,&nbsp;including&nbsp;those&nbsp;used&nbsp;by&nbsp;neural&nbsp;networks&nbsp;when&nbsp;reading&nbsp;code&nbsp;from&nbsp;links.<br>
<br>
We&nbsp;also&nbsp;**ignore&nbsp;comments&nbsp;in&nbsp;the&nbsp;programming&nbsp;language&nbsp;specified&nbsp;by&nbsp;`language`**&nbsp;(`c++`&nbsp;or&nbsp;`python`).&nbsp;This&nbsp;is&nbsp;done&nbsp;because&nbsp;a&nbsp;neural&nbsp;network&nbsp;often:<br>
<br>
*&nbsp;either&nbsp;“swallows”&nbsp;comments&nbsp;when&nbsp;rewriting&nbsp;the&nbsp;marker&nbsp;text&nbsp;—&nbsp;and&nbsp;then&nbsp;they&nbsp;need&nbsp;to&nbsp;be&nbsp;ignored;<br>
*&nbsp;or,&nbsp;on&nbsp;the&nbsp;contrary,&nbsp;includes&nbsp;a&nbsp;comment&nbsp;inside&nbsp;the&nbsp;marker&nbsp;—&nbsp;and&nbsp;that&nbsp;should&nbsp;also&nbsp;be&nbsp;handled&nbsp;correctly.<br>
<br>
Marker&nbsp;normalization&nbsp;rules:<br>
<br>
*&nbsp;spaces&nbsp;and&nbsp;tab&nbsp;characters&nbsp;at&nbsp;the&nbsp;beginning&nbsp;and&nbsp;end&nbsp;of&nbsp;each&nbsp;line&nbsp;are&nbsp;removed;<br>
*&nbsp;empty&nbsp;lines&nbsp;are&nbsp;ignored;<br>
*&nbsp;the&nbsp;resulting&nbsp;range&nbsp;`[begin,&nbsp;end]`&nbsp;is&nbsp;computed&nbsp;in&nbsp;terms&nbsp;of&nbsp;actual&nbsp;file&nbsp;lines,&nbsp;including&nbsp;removed&nbsp;empty&nbsp;ones.<br>
<br>
From&nbsp;CHUNK’s&nbsp;point&nbsp;of&nbsp;view,&nbsp;the&nbsp;following&nbsp;markers&nbsp;are&nbsp;identical:<br>
<br>
```<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;A<br>
<br>
B<br>
```<br>
<br>
and<br>
<br>
```<br>
A<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;B<br>
```<br>
<br>
because&nbsp;both&nbsp;normalize&nbsp;to:<br>
<br>
```<br>
A<br>
B<br>
```<br>
<br>
---<br>
<br>
##&nbsp;3.&nbsp;`payload`&nbsp;indentation<br>
<br>
By&nbsp;default,&nbsp;the&nbsp;indentation&nbsp;of&nbsp;the&nbsp;inserted&nbsp;text&nbsp;is&nbsp;aligned&nbsp;to&nbsp;the&nbsp;indentation&nbsp;of&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;marker,&nbsp;but&nbsp;this&nbsp;behavior&nbsp;can&nbsp;be&nbsp;changed:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;value()&nbsp;const;<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;value()&nbsp;const&nbsp;noexcept;<br>
&nbsp;&nbsp;&nbsp;&nbsp;options:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;indent:&nbsp;&lt;mode&gt;<br>
```<br>
<br>
Modes:<br>
<br>
*&nbsp;`from-marker`&nbsp;/&nbsp;`marker`&nbsp;/&nbsp;`auto`&nbsp;—&nbsp;align&nbsp;`payload`&nbsp;to&nbsp;the&nbsp;marker’s&nbsp;indentation&nbsp;&nbsp;<br>
&nbsp;&nbsp;(default&nbsp;mode&nbsp;if&nbsp;`options.indent`&nbsp;is&nbsp;not&nbsp;specified);<br>
*&nbsp;`none`&nbsp;/&nbsp;`as-is`&nbsp;—&nbsp;keep&nbsp;`payload`&nbsp;indentation&nbsp;“as&nbsp;is”&nbsp;according&nbsp;to&nbsp;YAML&nbsp;rules.<br>
<br>
Base&nbsp;indentation&nbsp;is&nbsp;taken&nbsp;from:<br>
<br>
*&nbsp;for&nbsp;text&nbsp;commands&nbsp;—&nbsp;the&nbsp;first&nbsp;line&nbsp;of&nbsp;the&nbsp;marker&nbsp;range;<br>
*&nbsp;for&nbsp;language&nbsp;commands&nbsp;(`replace_c_style_block`,&nbsp;`replace_py_block`,&nbsp;`replace_xml_block`)&nbsp;—&nbsp;the&nbsp;line&nbsp;with&nbsp;the&nbsp;block&nbsp;“header”&nbsp;(function&nbsp;signature,&nbsp;`if&nbsp;...`,&nbsp;`for&nbsp;...`,&nbsp;`def&nbsp;...`,&nbsp;`class&nbsp;...`&nbsp;and&nbsp;so&nbsp;on).<br>
<br>
Indentation&nbsp;is&nbsp;added&nbsp;only&nbsp;to&nbsp;**non-empty**&nbsp;lines&nbsp;of&nbsp;`payload`.<br>
<br>
---<br>
<br>
##&nbsp;4.&nbsp;File&nbsp;commands<br>
<br>
###&nbsp;4.1.&nbsp;`create_file`<br>
<br>
Create&nbsp;or&nbsp;overwrite&nbsp;a&nbsp;file:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/hello.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;create_file<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#include&nbsp;&lt;iostream&gt;<br>
<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;main()&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;std::cout&nbsp;&lt;&lt;&nbsp;&quot;Hello\n&quot;;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;0;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
```<br>
<br>
*&nbsp;`path`&nbsp;—&nbsp;target&nbsp;file.<br>
*&nbsp;`payload`&nbsp;—&nbsp;file&nbsp;contents&nbsp;(can&nbsp;be&nbsp;empty&nbsp;→&nbsp;empty&nbsp;file).<br>
<br>
###&nbsp;4.2.&nbsp;`delete_file`<br>
<br>
Delete&nbsp;a&nbsp;file:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/obsolete.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;delete_file<br>
```<br>
<br>
---<br>
<br>
##&nbsp;5.&nbsp;Text&nbsp;commands<br>
<br>
These&nbsp;commands&nbsp;operate&nbsp;on&nbsp;arbitrary&nbsp;text&nbsp;via&nbsp;a&nbsp;marker.<br>
<br>
Required&nbsp;fields:<br>
<br>
*&nbsp;`path`<br>
*&nbsp;`op:&nbsp;insert_after_text&nbsp;|&nbsp;insert_before_text&nbsp;|&nbsp;replace_text&nbsp;|&nbsp;delete_text&nbsp;|&nbsp;prepend_text&nbsp;|&nbsp;append_text`<br>
*&nbsp;`marker`&nbsp;—&nbsp;required&nbsp;for&nbsp;marker-based&nbsp;operations&nbsp;(`insert_after_text`,&nbsp;`insert_before_text`,&nbsp;`replace_text`,&nbsp;`delete_text`).<br>
<br>
For&nbsp;`prepend_text`&nbsp;and&nbsp;`append_text`&nbsp;the&nbsp;`marker`&nbsp;field&nbsp;is&nbsp;not&nbsp;used:&nbsp;they&nbsp;simply&nbsp;insert&nbsp;`payload`&nbsp;at&nbsp;the&nbsp;beginning&nbsp;or&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file.<br>
<br>
Additional&nbsp;fields:<br>
<br>
*&nbsp;`before`,&nbsp;`after`&nbsp;—&nbsp;optional&nbsp;context&nbsp;showing&nbsp;what&nbsp;surrounds&nbsp;the&nbsp;marker;<br>
*&nbsp;`payload`&nbsp;—&nbsp;required&nbsp;for&nbsp;all&nbsp;except&nbsp;`delete_text`;<br>
*&nbsp;`comment`&nbsp;—&nbsp;human-readable&nbsp;note&nbsp;for&nbsp;the&nbsp;operation;<br>
*&nbsp;`options.indent`&nbsp;—&nbsp;optional&nbsp;indentation&nbsp;mode&nbsp;(see&nbsp;section&nbsp;3).<br>
<br>
###&nbsp;5.1.&nbsp;`replace_text`<br>
<br>
Replace&nbsp;a&nbsp;fragment&nbsp;by&nbsp;marker:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;value()&nbsp;const;<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;value()&nbsp;const&nbsp;noexcept;<br>
```<br>
<br>
###&nbsp;5.2.&nbsp;`insert_after_text`<br>
<br>
Insert&nbsp;text&nbsp;immediately&nbsp;**after**&nbsp;the&nbsp;marker:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;insert_after_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;Foo::init()<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;do_stuff();<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;Foo::log_state()&nbsp;const<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;...<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
```<br>
<br>
###&nbsp;5.3.&nbsp;`insert_before_text`<br>
<br>
Insert&nbsp;text&nbsp;**before**&nbsp;the&nbsp;marker:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;insert_before_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;run();<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;public:<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;void&nbsp;debug_run();<br>
```<br>
<br>
###&nbsp;5.4.&nbsp;`delete_text`<br>
<br>
Delete&nbsp;a&nbsp;fragment&nbsp;by&nbsp;marker:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;delete_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;#include&nbsp;&quot;debug.h&quot;<br>
```<br>
<br>
###&nbsp;5.5.&nbsp;`prepend_text`<br>
<br>
Insert&nbsp;text&nbsp;at&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;file&nbsp;without&nbsp;a&nbsp;marker:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;prepend_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;This&nbsp;block&nbsp;will&nbsp;be&nbsp;inserted&nbsp;at&nbsp;the&nbsp;very&nbsp;beginning&nbsp;of&nbsp;the&nbsp;file.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;...<br>
```<br>
<br>
###&nbsp;5.6.&nbsp;`append_text`<br>
<br>
Insert&nbsp;text&nbsp;at&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;file&nbsp;without&nbsp;a&nbsp;marker:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;append_text<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;This&nbsp;block&nbsp;will&nbsp;be&nbsp;added&nbsp;to&nbsp;the&nbsp;very&nbsp;end&nbsp;of&nbsp;the&nbsp;file.<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;...<br>
```<br>
<br>
---<br>
<br>
##&nbsp;6.&nbsp;Commands&nbsp;for&nbsp;C-style,&nbsp;Python&nbsp;and&nbsp;XML&nbsp;blocks<br>
<br>
These&nbsp;commands&nbsp;operate&nbsp;not&nbsp;on&nbsp;arbitrary&nbsp;text,&nbsp;but&nbsp;on&nbsp;**logical&nbsp;code&nbsp;blocks**&nbsp;(functions,&nbsp;methods,&nbsp;`if`&nbsp;or&nbsp;`for`&nbsp;blocks,&nbsp;and&nbsp;so&nbsp;on).<br>
<br>
Supported&nbsp;commands:<br>
<br>
*&nbsp;`replace_c_style_block`<br>
*&nbsp;`replace_py_block`<br>
*&nbsp;`replace_xml_block`<br>
<br>
Common&nbsp;fields:<br>
<br>
*&nbsp;`path`<br>
*&nbsp;`op`<br>
*&nbsp;`marker`&nbsp;—&nbsp;block&nbsp;“header”&nbsp;(see&nbsp;below);<br>
*&nbsp;`payload`&nbsp;—&nbsp;new&nbsp;code&nbsp;for&nbsp;the&nbsp;whole&nbsp;block;<br>
*&nbsp;`before`,&nbsp;`after`&nbsp;—&nbsp;optional&nbsp;context&nbsp;around&nbsp;the&nbsp;marker;<br>
*&nbsp;`comment`&nbsp;—&nbsp;human-readable&nbsp;note&nbsp;for&nbsp;the&nbsp;operation;<br>
*&nbsp;`options.indent`&nbsp;—&nbsp;indentation&nbsp;mode&nbsp;(same&nbsp;as&nbsp;in&nbsp;section&nbsp;3).<br>
<br>
###&nbsp;6.1.&nbsp;C-style&nbsp;code:&nbsp;`replace_c_style_block`<br>
<br>
Replaces&nbsp;a&nbsp;C-style&nbsp;code&nbsp;block&nbsp;(function,&nbsp;method,&nbsp;`if`&nbsp;block&nbsp;and&nbsp;so&nbsp;on)&nbsp;delimited&nbsp;by&nbsp;braces.<br>
<br>
*&nbsp;`marker`&nbsp;must&nbsp;include&nbsp;the&nbsp;block&nbsp;header&nbsp;from&nbsp;the&nbsp;first&nbsp;line&nbsp;of&nbsp;the&nbsp;signature&nbsp;down&nbsp;to&nbsp;the&nbsp;line&nbsp;with&nbsp;the&nbsp;opening&nbsp;`{`.&nbsp;&nbsp;<br>
&nbsp;&nbsp;During&nbsp;search,&nbsp;comments&nbsp;and&nbsp;extra&nbsp;spaces&nbsp;are&nbsp;ignored&nbsp;just&nbsp;like&nbsp;in&nbsp;`replace_text`.<br>
*&nbsp;Replacement&nbsp;range&nbsp;spans&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;marker&nbsp;to&nbsp;the&nbsp;corresponding&nbsp;closing&nbsp;`}`.<br>
<br>
Example:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_c_style_block<br>
&nbsp;&nbsp;&nbsp;&nbsp;comment:&nbsp;&quot;Update&nbsp;Foo::value&nbsp;implementation&nbsp;in&nbsp;C++&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;Foo::value()&nbsp;const<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;Foo::value()&nbsp;const<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;//&nbsp;new&nbsp;logic<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;42;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
```<br>
<br>
###&nbsp;6.2.&nbsp;Python-style&nbsp;code:&nbsp;`replace_py_block`<br>
<br>
Command&nbsp;for&nbsp;Python&nbsp;blocks,&nbsp;analogous&nbsp;to&nbsp;`replace_c_style_block`,&nbsp;but&nbsp;using&nbsp;a&nbsp;colon&nbsp;and&nbsp;indentation&nbsp;instead&nbsp;of&nbsp;braces.<br>
<br>
*&nbsp;`marker`&nbsp;must&nbsp;include&nbsp;the&nbsp;line&nbsp;with&nbsp;the&nbsp;colon&nbsp;that&nbsp;opens&nbsp;the&nbsp;block&nbsp;(`if&nbsp;...:`,&nbsp;`for&nbsp;...:`,&nbsp;`while&nbsp;...:`,&nbsp;`with&nbsp;...:`,&nbsp;`def&nbsp;...:`,&nbsp;`class&nbsp;...:`&nbsp;and&nbsp;so&nbsp;on).<br>
*&nbsp;Replacement&nbsp;range&nbsp;spans&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;marker&nbsp;to&nbsp;the&nbsp;end&nbsp;of&nbsp;the&nbsp;block,&nbsp;that&nbsp;is,&nbsp;up&nbsp;to&nbsp;the&nbsp;first&nbsp;line&nbsp;whose&nbsp;indentation&nbsp;is&nbsp;**not&nbsp;greater**&nbsp;than&nbsp;the&nbsp;indentation&nbsp;of&nbsp;the&nbsp;header&nbsp;line.&nbsp;Empty&nbsp;lines&nbsp;inside&nbsp;the&nbsp;block&nbsp;are&nbsp;allowed&nbsp;and&nbsp;do&nbsp;not&nbsp;terminate&nbsp;it.<br>
*&nbsp;Other&nbsp;fields&nbsp;(`payload`,&nbsp;`before`,&nbsp;`after`,&nbsp;`options.indent`)&nbsp;behave&nbsp;the&nbsp;same&nbsp;as&nbsp;for&nbsp;`replace_c_style_block`.<br>
<br>
Example:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.py<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_py_block<br>
&nbsp;&nbsp;&nbsp;&nbsp;comment:&nbsp;&quot;Update&nbsp;Foo.run&nbsp;implementation&nbsp;in&nbsp;Python&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;run(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;run(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;value:&quot;,&nbsp;self.value)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.value<br>
```<br>
<br>
###&nbsp;6.3.&nbsp;XML&nbsp;code:&nbsp;`replace_xml_block`<br>
<br>
Command&nbsp;for&nbsp;XML-like&nbsp;blocks&nbsp;based&nbsp;on&nbsp;matching&nbsp;opening&nbsp;and&nbsp;closing&nbsp;tags.<br>
<br>
*&nbsp;`marker`&nbsp;must&nbsp;include&nbsp;the&nbsp;line&nbsp;with&nbsp;the&nbsp;opening&nbsp;tag&nbsp;(for&nbsp;example,&nbsp;`&lt;item&gt;`&nbsp;or&nbsp;`&lt;item&nbsp;id=&quot;foo&quot;&gt;`).&nbsp;Marker&nbsp;search&nbsp;uses&nbsp;the&nbsp;same&nbsp;normalization&nbsp;rules&nbsp;as&nbsp;for&nbsp;other&nbsp;commands.<br>
*&nbsp;The&nbsp;replacement&nbsp;range&nbsp;spans&nbsp;from&nbsp;the&nbsp;beginning&nbsp;of&nbsp;the&nbsp;marker&nbsp;to&nbsp;the&nbsp;matching&nbsp;closing&nbsp;tag&nbsp;`&lt;/tag_name&gt;`,&nbsp;taking&nbsp;into&nbsp;account&nbsp;nested&nbsp;tags&nbsp;with&nbsp;the&nbsp;same&nbsp;name.<br>
*&nbsp;A&nbsp;block&nbsp;can&nbsp;be&nbsp;self-closing&nbsp;(`&lt;tag&nbsp;...&nbsp;/&gt;`)&nbsp;—&nbsp;in&nbsp;this&nbsp;case&nbsp;only&nbsp;that&nbsp;tag&nbsp;is&nbsp;replaced.<br>
*&nbsp;Other&nbsp;fields&nbsp;(`payload`,&nbsp;`before`,&nbsp;`after`,&nbsp;`options.indent`)&nbsp;behave&nbsp;the&nbsp;same&nbsp;as&nbsp;in&nbsp;`replace_c_style_block`.<br>
<br>
Example:<br>
<br>
```yaml<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;config.xml<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_xml_block<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;item&nbsp;id=&quot;foo&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;item&nbsp;id=&quot;foo&quot;&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;value&gt;42&lt;/value&gt;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&lt;/item&gt;<br>
```<br>
<br>
---<br>
<br>
##&nbsp;7.&nbsp;Example&nbsp;of&nbsp;a&nbsp;full&nbsp;patch<br>
<br>
```yaml<br>
description:&nbsp;&quot;Update&nbsp;value&nbsp;implementation&nbsp;in&nbsp;C++&nbsp;and&nbsp;Python&quot;<br>
language:&nbsp;c++<br>
<br>
operations:<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.cpp<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_c_style_block<br>
&nbsp;&nbsp;&nbsp;&nbsp;comment:&nbsp;&quot;Update&nbsp;Foo::value&nbsp;implementation&nbsp;in&nbsp;C++&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;Foo::value()&nbsp;const<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;int&nbsp;Foo::value()&nbsp;const<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;{<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;42;<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;}<br>
<br>
&nbsp;&nbsp;-&nbsp;path:&nbsp;src/foo.py<br>
&nbsp;&nbsp;&nbsp;&nbsp;op:&nbsp;replace_py_block<br>
&nbsp;&nbsp;&nbsp;&nbsp;comment:&nbsp;&quot;Update&nbsp;Foo.run&nbsp;implementation&nbsp;in&nbsp;Python&quot;<br>
&nbsp;&nbsp;&nbsp;&nbsp;marker:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;run(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;payload:&nbsp;|-<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;def&nbsp;run(self):<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;print(&quot;value:&quot;,&nbsp;self.value)<br>
&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;&nbsp;return&nbsp;self.value<br>
```<br>
<!-- END SCAT CODE -->
</body>
</html>
